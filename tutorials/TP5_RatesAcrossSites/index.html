<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://boussau.github.io/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <title>Bastien Boussau's github website: TP5 Accounting for variation in substitution rates across sites</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="pull-left">
        
        <img class="navbar-logo" src="/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
      <li><a href="/tutorials/">Tutorials</a></li>
      <li><a href="/tutorials/relative_time_constraints/">Dating with relative constraints</a></li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <div class="titlebar">
	<h1 class="maintitle">TP5 Accounting for variation in substitution rates across sites</h1>
	<h3 class="subtitle">A mixture model to account for rate variation across sites</h3>
	<h4 class="authors">Nicolas Lartillot</h4>
  <h5>Last modified on November  2, 2020</h5>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul id="prerequisites">
          
            <li><a href="/tutorials/TP1_simulatingDNAEvolution/">TP1 Understanding models of DNA sequence evolution</a></li>
          
            <li><a href="/tutorials/TP2_JukesCantorHumanChimp/">TP2 Implementing Bayesian inference with RevBayes</a></li>
          
            <li><a href="/tutorials/TP3_JC_PhylogenyReconstruction/">TP3 Phylogenetic reconstruction on nucleotide data</a></li>
          
            <li><a href="/tutorials/TP4_SubstitutionModels/">TP4 Nucleotide substitution models</a></li>
          
          </ul>
        
    </div>
  </div>
  
</blockquote>





<blockquote class="tutorial_files" id="tutorial_files">
    <h2>Data files and scripts</h2>
    
        
        <strong>Data Files</strong>
        <ul id="data_files">
        
        
        
          <li><a href="/tutorials/TP5_RatesAcrossSites/data/placBRCA1short.nex">placBRCA1short.nex</a></li>
        
          <li><a href="/tutorials/TP5_RatesAcrossSites/data/placBRCA1third.nex">placBRCA1third.nex</a></li>
        
        </ul>
    
        
        <strong>Scripts</strong>
        <ul id="scripts">
        
        
        
          <li><a href="/tutorials/TP5_RatesAcrossSites/scripts/phyloT92rasthird.rev">phyloT92rasthird.rev</a></li>
        
        </ul>
    
</blockquote>


</div>
<p>Thus far, all phylogenetic models that we have considered assume that all sites evolve at the same rate and under the same substitution process (such as specified by the rate matrix $Q$). In reality, different sites are under different constraints. As a result, some sites might be fast evolving, while other sites might be slowly evolving. We need to account for this variation across sites in our models.</p>

<h2 class="section" id="a-random-effect-model-with-gamma-distributed-rates-across-sites">A random-effect model with gamma-distributed rates across sites</h2>
<hr class="section" />

<p>The most widely used approach to model varying rates across sites is to use a random-effect model. The idea is to assume that each site has a certain rate of evolution (let us call it $r_i$, for site $i$). These rates are assumed to be independent and identically distributed across sites from a parametric distribution. Generally, we assume a gamma distribution.</p>

<p>A gamma distribution has two parameters: a shape parameter ($\alpha$) and a scale parameter ($\beta$). You can have a look at the Wikipedia page about the gamma distribution to have more information. The mean of the distribution is equal to $\alpha / \beta$, and the variance is $\alpha / \beta^2$. Thus, by tuning the values of these two parameters, $\alpha$ and $\beta$, we can create a broad variety of distributions, with arbitrary mean and variance.</p>

<p>Here, we want to model the relative rates across sites (we don’t need to model the absolute rates because we have the branch lengths, or the total tree length, which will capture the overall rate of evolution). So, we can constrain the mean to be equal to 1, which is equivalent to setting $\beta = \alpha$. As a result, our distribution has only one parameter, $\alpha$, and the variance of the distribution is equal to $\alpha / \alpha^2 = 1 /\alpha$.</p>

<p>Computationally speaking, averaging the likelihood over a gamma distribution at each site is difficult. For that reason, most often, the gamma distribution is discretized, into a small number of categories (typically, as few as $K=4$ categories). As a result, the integral at each site can be done by simply averaging the likelihood over the $K$ categories.</p>

<h2 class="section" id="implementing-the-model-in-revbayes">Implementing the model in RevBayes</h2>
<hr class="section" />

<p>We don’t know the value of the shape parameter $\alpha$, or equivalently, we don’t know the variance of the gamma distribution (which, as we said, is the inverse of $\alpha$). So, we need to consider it as a parameter, with a prior. Here, we parameterize directly in terms of the variance. We use a broad exponential prior, of mean 5 (thus, of rate $\lambda = 0.2$):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rate_var ~ dnExponential(lambda=0.2)
</code></pre></div></div>
<p>Then, we set $\alpha$ as a deterministic variable, equal to the inverse of the variance:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alpha := 1.0 / rate_var
</code></pre></div></div>

<p>Next, we create a discretized gamma distribution with 4 categories, of shape and scale parameters both equal to $\alpha$:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>disc_rates := fnDiscretizeGamma(alpha, alpha, 4)
</code></pre></div></div>

<p>Finally, we specify the substitution process. Now, in addition to the tree and the substitution rate matrix $Q$, we also specify the distribution rates across sites with the <code class="highlighter-rouge">siteRates</code> keyword:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>seq ~ dnPhyloCTMC(tree=psi, Q=Q, siteRates=disc_rates, type="DNA" )
</code></pre></div></div>

<p>For the rest, the script is as before. The rate matrix Q could be anything: either the JC, or the T92 or the HKY or the GTR model. Here, we will analyse the BRCA1 gene (again, and short version), for which we can use the T92 model. Concerning the moves, don’t forget to add a move (a scaling move) for the ‘rate_var’ parameter.</p>

<p>Draw the graph of this model. Write the script and run it on the BRCA1 gene. Try first with all coding positions (<code class="highlighter-rouge">BRCA1short.nex</code>), and then with only the third coding positions (<code class="highlighter-rouge">BRCA1third.nex</code>). Run for 10 000 generations. Using Tracer, visualize the traces, determine the burnin, visualize the posterior distribution on the variance parameter and obtain a point estimate and a 95\% credible interval. Do this for the two datasets (all coding positions and third coding positions). How do you interpret the difference in the variance parameter between these two datasets?</p>

<p>Do you see major differences in tree inference, compared to the model without rates across sites?</p>


<ol class="bibliography"></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a>  | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/assets/js/vendor/jquery.min.js"></script>
<script src="/assets/js/vendor/FileSaver.min.js"></script>
<script src="/assets/js/vendor/jszip.min.js"></script>
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
    });
    MathJax.Hub.Queue(function () {
      $(".aside").each(function() {
          $("div .MathJax", this).hide();
      });
    });
</script>
<script src="/assets/js/base.js"></script>

  </body>
</html>
